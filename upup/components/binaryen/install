#!/usr/bin/env bash

CTX=$(dirname "$0")
source "$CTX/../../support"

install() {
    local repo="WebAssembly/binaryen"
    local name="binaryen"
    local ver=$(up_github_latest "$repo")
    local pkg="$name/$ver.tar.gz"
    local dir="$INSTALLED/$name/$ver"
    local arch=$(select_arch "x86_64")
    local plat=$(select_plat "macos" "linux")
    local url="https://github.com/$repo/releases/download/$ver/$name-$ver-$arch-$plat.tar.gz"
    if [ ! -d "$dir" ]; then
        local t=$(mktemp -d -t "install-")
        up_download "$pkg" "$url"
        tar xfz "$PKGS/$pkg" -C "$t" --strip-components 1
        up_ensure_path "$dir"
        mv "$t" "$dir"
    fi
    up_activate "$name" "$ver"
}

install
